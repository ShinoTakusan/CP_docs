# 繰り返し自乗法

## 繰り返し自乗法とは

繰り返し2乗法とは、整数のn乗を効率よく求める方法である。任意の整数aのn乗をaをn解かけると実装(下のような実装)した場合$$O(n)$$となる。この計算量を繰り返し自乗法を使うことで$$O(logn)$$にすることができる。

```cpp
ll res = 1;
for(int i = 0; i < n; i++)
    res *= a;
```

## 考え方

考え方は至って単純である。試しに$$2^10$$で考える。これは以下のように分解することが可能である。

$$
\begin{aligned}
2^{10}&=(2^5)^2\\
      &=((2^2)^2\times2^1)^2\\
      &=(((2^1)^2)^2\times2^1)^2\\
\end{aligned}
$$

このような分解の考え方を利用して計算量を減らすことができる。

## 実装

では、上の考え方にそって実装をしていく。

```cpp
ll power(ll n, ll a)
{
    ll res = 1;
    while (n)
    {
        if (n % 2)//2進数を利用してn & 1と論理和をとってもいい。
        {
            res = res * a;
        }
        a = a * a;
        n >>= 1;//nを右に1シフト、つまり、÷2(切り捨て)
    }
    return res;
}
```

最後にnを割る2していることからも分かる通り、計算量は$$O(logn)$$となる。

参考：

[繰り返し自乗法](http://satanic0258.hatenablog.com/entry/2016/04/29/004730)